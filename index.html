<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pathology Race: Lab 1</title>
    <style>
        :root { --med-blue: #2c3e50; --biotech-pink: #ec407a; --glass: rgba(255, 255, 255, 0.9); }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #game-box { max-width: 800px; width: 100%; background: var(--glass); backdrop-filter: blur(10px); padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); text-align: center; }
        
        .microscope-lens { width: 350px; height: 350px; border: 15px solid #333; border-radius: 50%; margin: 0 auto 20px; overflow: hidden; background: #000; box-shadow: inset 0 0 30px #000, 0 10px 20px rgba(0,0,0,0.2); position: relative; }
        #histo-img { width: 100%; height: 100%; object-fit: cover; filter: blur(20px); transition: filter 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .hud { display: flex; justify-content: space-between; font-weight: 800; font-size: 1.2rem; color: var(--med-blue); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .focus-btn { background: #333; color: #00ff00; border: 2px solid #00ff00; padding: 10px 20px; border-radius: 30px; cursor: pointer; font-weight: bold; margin-bottom: 20px; box-shadow: 0 0 10px rgba(0,255,0,0.3); }
        .focus-btn:active { transform: scale(0.95); }
        
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        button.option { padding: 15px; border: 2px solid var(--med-blue); border-radius: 12px; background: white; color: var(--med-blue); font-weight: 600; cursor: pointer; transition: 0.3s; }
        button.option:hover { background: var(--med-blue); color: white; transform: translateY(-3px); }
        
        #leaderboard { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="game-box">
    <div class="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Streak: <span id="streak">0</span>x</div>
    </div>

    <div class="microscope-lens">
        <img id="histo-img" src="" alt="Focus required">
    </div>

    <button class="focus-btn" onclick="adjustFocus()">üî¨ ROTATE MICROSCOPE FOCUS</button>

    <div id="quiz-section">
        <h3 id="question-text">Identify the specimen...</h3>
        <div class="options-grid" id="options"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h1>üèÜ LAB COMPLETED</h1>
        <p id="final-status"></p>
        <div id="leaderboard">
            <h3>Local High Scores</h3>
            <ul id="score-list" style="list-style:none; padding:0;"></ul>
        </div>
        <button onclick="location.reload()" class="focus-btn" style="color:white; border-color:white; margin-top:20px;">RESTART CHALLENGE</button>
    </div>
</div>

<script>
    const labData = [
        { img: "img2.jpg", q: "Flattened, polygonal cells with centrally located nuclei. Found in endothelial lining.", a: "Simple Squamous", info: "Matches Image 2 in your Lab." },
        { img: "img3.jpg", q: "Extremely thin layer lining 95-97% of lung alveoli.", a: "Type I Pneumocytes", info: "Visible as a very thin layer in light microscopy." },
        { img: "img4.jpg", q: "Cells are roughly square on transverse section. Found in renal tubules.", a: "Simple Cuboidal", info: "Typical for glandular ducts and ovaries." },
        { img: "img7.jpg", q: "Appears stratified, but all cells contact the basement membrane.", a: "Pseudostratified Columnar", info: "Typical for the trachea and respiratory passages." },
        { img: "img8.jpg", q: "Features large surface 'Umbrella' cells with 1-2 nuclei.", a: "Transitional Epithelium", info: "Adapted for volume changes in the bladder." },
        { img: "img9.jpg", q: "Single-cell glands with a narrow stalk and dilated apical part.", a: "Goblet Cells", info: "Secretes mucus in respiratory and intestinal tracts." }
    ];

    let score = 0;
    let streak = 0;
    let currentIdx = 0;
    let blur = 20;

    function adjustFocus() {
        blur = Math.max(0, blur - 5);
        document.getElementById('histo-img').style.filter = `blur(${blur}px)`;
    }

    function initLevel() {
        if (currentIdx >= labData.length) return endGame();
        
        const current = labData[currentIdx];
        blur = 20;
        const img = document.getElementById('histo-img');
        img.src = current.img;
        img.style.filter = `blur(20px)`;
        img.onerror = () => { img.alt = "‚ö†Ô∏è MISSING FILE: Upload " + current.img + " to GitHub"; };
        
        document.getElementById('question-text').innerText = current.q;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        
        const choices = [current.a, "Stratified Squamous", "Simple Columnar", "Dense Connective"].sort(() => Math.random() - 0.5);
        
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerText = c;
            btn.onclick = () => check(c, current.a);
            opts.appendChild(btn);
        });
    }

    function check(choice, correct) {
        document.getElementById('histo-img').style.filter = "blur(0px)";
        if (choice === correct) {
            score += 100 + (streak * 25);
            streak++;
            alert("‚úÖ Correct! " + labData[currentIdx].info);
        } else {
            streak = 0;
            alert("‚ùå Incorrect! The correct answer was " + correct);
        }
        
        document.getElementById('score').innerText = score;
        document.getElementById('streak').innerText = streak;
        currentIdx++;
        setTimeout(initLevel, 500);
    }

    function endGame() {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        saveScore(score);
    }

    function saveScore(s) {
        let scores = JSON.parse(localStorage.getItem('histoScores') || '[]');
        scores.push({s, d: new Date().toLocaleDateString()});
        scores.sort((a,b) => b.s - a.s);
        localStorage.setItem('histoScores', JSON.stringify(scores.slice(0, 5)));
        
        const list = document.getElementById('score-list');
        scores.slice(0, 5).forEach(item => {
            list.innerHTML += `<li>Score: ${item.s} ‚Äî ${item.d}</li>`;
        });
    }

    initLevel();
</script>

</body>
</html>
